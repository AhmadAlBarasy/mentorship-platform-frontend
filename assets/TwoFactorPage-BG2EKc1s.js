import{r as i,d as N,h as w,u as k,j as e,e as S,S as A,R as C,L,A as F}from"./index-DjaPym5F.js";import{L as R}from"./Logo-D8Wy8gr_.js";function E(){const[r,o]=i.useState(300),[g,c]=i.useState(!1),l=N(),{register:u,handleSubmit:h,formState:{errors:d,isSubmitting:m},watch:b}=w(),{verify2FA:a,resend2FA:s}=k(),f=b("code","");i.useEffect(()=>{if(r>0){const t=setTimeout(()=>o(r-1),1e3);return()=>clearTimeout(t)}else c(!0)},[r]);const x=t=>{const n=Math.floor(t/60),v=t%60;return`${n}:${v.toString().padStart(2,"0")}`},y=async t=>{try{await a.mutateAsync(t.code),l("/dashboard")}catch(n){console.error("2FA verification failed:",n)}},j=async()=>{try{await s.mutateAsync(),o(300),c(!1)}catch(t){console.error("Resend failed:",t)}},p=()=>{localStorage.clear(),sessionStorage.clear(),l("/login")};return e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex flex-col justify-center py-12 sm:px-6 lg:px-8 relative",children:[e.jsx("div",{className:"absolute top-4 right-4",children:e.jsxs("button",{onClick:p,className:"inline-flex items-center px-3 py-2 border border-gray-300 dark:border-gray-600 text-sm leading-4 font-medium rounded-md shadow-sm text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-800 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[e.jsx(S,{className:"h-4 w-4 mr-2"}),"Sign Out"]})}),e.jsxs("div",{className:"sm:mx-auto sm:w-full sm:max-w-md",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx(R,{withLink:!0})}),e.jsx("h2",{className:"mt-6 text-center text-3xl font-bold text-gray-900 dark:text-white",children:"Two-Factor Authentication"}),e.jsx("p",{className:"mt-2 text-center text-sm text-gray-600 dark:text-gray-300",children:"We've sent a 6-digit code to your email address. Enter it below to complete your login."})]}),e.jsx("div",{className:"mt-8 sm:mx-auto sm:w-full sm:max-w-md",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 py-8 px-4 shadow sm:rounded-lg sm:px-10",children:[e.jsx("div",{className:"flex justify-center mb-6",children:e.jsx("div",{className:"flex items-center justify-center h-16 w-16 rounded-full bg-blue-100 dark:bg-blue-200",children:e.jsx(A,{className:"h-8 w-8 text-blue-600"})})}),e.jsxs("form",{className:"space-y-6",onSubmit:h(y),children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"code",className:"block text-sm font-medium text-gray-700 dark:text-gray-200 text-center mb-2",children:"Enter 6-digit code"}),e.jsx("input",{id:"code",type:"text",maxLength:"6",placeholder:"000000",className:`w-full px-3 py-3 border rounded-md shadow-sm text-center text-2xl font-mono tracking-widest focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-400 dark:placeholder-gray-500 ${d.code?"border-red-300":"border-gray-300 dark:border-gray-600"}`,...u("code",{required:"Verification code is required",pattern:{value:/^\d{6}$/,message:"Code must be 6 digits"}}),onChange:t=>{t.target.value=t.target.value.replace(/\D/g,"")}}),d.code&&e.jsx("div",{className:"mt-1 text-sm text-red-600 text-center",children:d.code.message})]}),e.jsx("div",{className:"text-center",children:r>0?e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Code expires in ",x(r)]}):e.jsx("p",{className:"text-sm text-red-600",children:"Code has expired"})}),e.jsx("button",{type:"submit",disabled:m||a.isPending||f.length!==6,className:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:m||a.isPending?"Verifying...":"Verify Code"}),a.error&&e.jsx("div",{className:"rounded-md bg-red-50 dark:bg-red-200 p-4",children:e.jsx("div",{className:"text-sm text-red-700 text-center",children:a.error.message})})]}),e.jsx("div",{className:"mt-6 text-center",children:g?e.jsxs("button",{onClick:j,disabled:s.isPending,className:"inline-flex items-center text-sm text-blue-600 hover:text-blue-500 dark:text-blue-400 dark:hover:text-blue-300 disabled:opacity-50",children:[e.jsx(C,{className:`h-4 w-4 mr-1 ${s.isPending?"animate-spin":""}`}),s.isPending?"Sending...":"Resend Code"]}):e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Didn't receive the code?"," ",e.jsxs("span",{className:"text-gray-400 dark:text-gray-500",children:["Wait ",x(r)," to resend"]})]})}),s.isSuccess&&e.jsx("div",{className:"mt-4 rounded-md bg-green-50 dark:bg-green-200 p-4",children:e.jsx("div",{className:"text-sm text-green-700 text-center",children:"New code sent to your email!"})}),s.error&&e.jsx("div",{className:"mt-4 rounded-md bg-red-50 dark:bg-red-200 p-4",children:e.jsx("div",{className:"text-sm text-red-700 text-center",children:s.error.message})}),e.jsx("div",{className:"mt-6 text-center",children:e.jsxs(L,{to:"/login",className:"inline-flex items-center text-sm text-gray-600 dark:text-gray-300 hover:text-gray-500 dark:hover:text-white",children:[e.jsx(F,{className:"h-4 w-4 mr-1"}),"Back to Login"]})})]})})]})}export{E as default};
